## **RBAC:Role based user access control**

## 基于角色的用户权限控制

**rbac实现流程：1.用户登陆 --> 2.(3)权限初始化(读取当前用户拥有的所有权限，放入session中) --> 3(2).中间件读取权限信息做权限校验**

**<u>用户所有请求都会先穿过中间件，在中间件中会读取当前用户请求url，如果是白名单的话会直接放行，进入用户登陆校验，然后做权限初始化，将当前用户所拥有的所有权限与菜单信息全部获取写入session。</u>**

*<u>用户再次发出请求，穿过中间件的时候仍然会做权限校验，是否登陆、是否有权限访问......</u>**

# 一、路径导航

### **实现原理：**在权限初始化的时候将用户的所有权限信息、菜单信息、以及二级菜单和三级操作对应的title、url、id放入**菜单session**中，用户登陆时候**中间件**读取这部分信息，再次写入到request对象中的一个自定义属性中，展示到前端页面；



# 二、权限粒度控制到按钮

**功能：**<u>在访问一个页面的时候，如果用户没有 **添加**、**编辑**、**删除** 的权限，那么就隐藏掉对应的按钮</u>

**实现：**权限初始化的时候将权限信息字典的<u>**key**</u>设置成<u>**权限的别名**</u>，数据库中将每个权限的别名设置成unique=True，确保唯一性，因为url（权限）别名是唯一的，字典的key也是唯一的！

**应用：**

```python
# 权限粒度控制到按钮
@register.filter
def hasPermission(request, name):
    if name in request.session[sys.PERMISSION_SESSION_KEY]:
        return True
```

**！！filter装饰器可以用来进行判断！！**

**filter装饰器最多可以有两个参数！**

**参数规范：**

```python
{% if request|hasPermission:"role_add" %}
	<a href="{% url 'role_add' %}">添加角色</a>
{% endif %}
```

